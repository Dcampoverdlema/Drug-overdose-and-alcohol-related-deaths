---
title: "Drug overdose and alcohol related deaths"
author: 
- Dennis Campoverde-Lema
- Samantha Parras 
- Jodie Chen 
date: "July 26, 2024"
toc: true
format:
  html:
    theme: cosmo
    html-math-method: katex
    self-contained: true
execute:
  echo: false
  warning: false
  message: false
---

# Introduction

Use of drugs and alcohol has substantial financial consequences. Every year, excessive alcohol use costs 249 billion dollars in lost productivity, medical expenditures, and criminal justice costs. In contrast, illicit drug usage costs 193 billion dollars in lost productivity, criminality, and medical costs.

Communities can benefit from adopting and putting into practice policies that lessen prescription drug abuse and excessive alcohol consumption.

source: https://www.countyhealthrankings.org/health-data/health-factors/health-behaviors/alcohol-and-drug-use


# Our Question

**Are there demographic and social factors that are predictors of drug overdose and alcohol-related incidents (e.g., driving accidents)?**

# Data

**The data is collected by the University of Wisconsin Population Health Institute. It assigns a ranking based on health outcomes and health factors to each county in every state. There was originally 770 variables in the data set.**

**Since the data set is so big, we decided that we should create another data set with only the variables we want to look at with relation to drug overdose deaths and alcohol impaired driving deaths. This is all demographic and social variables** 

```{r} 
library(janitor)
library(ggplot2)
library(tidyverse)
library(sf)

```


```{r, include=FALSE}

health_data_new <- read.csv("data/health_data_selected.csv") |>  
  slice(-1) |> 
  mutate(across(everything(), ~ifelse(is.na(.) | . == 0, mean(., na.rm = TRUE), .))) |>  
  subset(select=-living_wage)

```
 
**Upon inspection, we found that the variable of drug overdose deaths had lots of N/A values and we want to make sure this is clean as this is one of the main variables we want to look at. ** 

**Also rename the data so that it can be read easier**

```{r, include=FALSE} 

```

# Intial EDA 

Lets look at the state comparisons for drug overdose deaths and alcohol impaired driving deaths. This can help us locate any patterns potentially in the future.  


```{r, include=FALSE} 
health_data <- read.csv("data/analytic_data2024.csv") %>%  
  clean_names()

selected_data <- health_data %>% 
  select(
    state_fips_code, county_fips_code, state_abbreviation, name,
    drug_overdose_deaths_raw_value, alcohol_impaired_driving_deaths_raw_value,
    unemployment_raw_value, income_inequality_raw_value, high_school_completion_raw_value, 
    adult_smoking_raw_value, excessive_drinking_raw_value, median_household_income_raw_value,
    some_college_raw_value, children_in_poverty_raw_value, children_in_single_parent_households_raw_value,
    social_associations_raw_value, x_below_18_years_of_age_raw_value, 
    x_65_and_older_raw_value, x_non_hispanic_black_raw_value, 
    x_american_indian_or_alaska_native_raw_value, x_asian_raw_value, 
    x_native_hawaiian_or_other_pacific_islander_raw_value, x_hispanic_raw_value, 
    x_non_hispanic_white_raw_value, x_not_proficient_in_english_raw_value, 
    x_female_raw_value, x_rural_raw_value
  )

# Convert relevant columns to numeric
selected_data <- selected_data |> 
  mutate(across(
    starts_with("drug_overdose_deaths_raw_value") | starts_with("alcohol_impaired_driving_deaths_raw_value") |
      starts_with("unemployment_raw_value") | starts_with("income_inequality_raw_value") | 
      starts_with("high_school_completion_raw_value") | starts_with("adult_smoking_raw_value") |
      starts_with("excessive_drinking_raw_value") | starts_with("median_household_income_raw_value") |
      starts_with("some_college_raw_value") | starts_with("children_in_poverty_raw_value") | 
      starts_with("children_in_single_parent_households_raw_value") | 
      starts_with("social_associations_raw_value") | starts_with("x_below_18_years_of_age_raw_value") | 
      starts_with("x_65_and_older_raw_value") | starts_with("x_non_hispanic_black_raw_value") | 
      starts_with("x_american_indian_or_alaska_native_raw_value") | starts_with("x_asian_raw_value") | 
      starts_with("x_native_hawaiian_or_other_pacific_islander_raw_value") | starts_with("x_hispanic_raw_value") | 
      starts_with("x_non_hispanic_white_raw_value") | starts_with("x_not_proficient_in_english_raw_value") | 
      starts_with("x_female_raw_value") | starts_with("x_rural_raw_value"),
    as.numeric
  ))
```


```{r} 
library(maps)
state_data <- selected_data |>
  filter(county_fips_code=='000',state_abbreviation!="US", state_abbreviation !="DC") |>  
  rename(state=name) 
state_data$state <- tolower(state_data$state)

us_states_map <- map_data("state")

merged_data <- us_states_map %>%
  left_join(state_data, by = c("region" = "state"))

ggplot(data = merged_data, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = drug_overdose_deaths_raw_value), color = "white") +
  scale_fill_viridis_c(option = "plasma", na.value = "grey50") +
  coord_fixed(1.3)+
 theme_minimal() +  # Apply the minimal theme
  theme(
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),  # Remove axis ticks
    text = element_text(family = "serif"),  # Set global text family to serif
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Center, bold the title, and increase font size
    plot.subtitle = element_text(hjust = 0.5, face = "plain", size = 8),  # Center the subtitle, normal weight, and reduce font size
    plot.caption = element_text(face = "italic", size = 6, hjust = 0)  # Italicize, reduce font size of the caption, and left-align
  ) +
  labs(
    title = "Drug Overdose Deaths by State",
    subtitle = "Data source: County Health Rankings & Roadmaps (https://www.countyhealthrankings.org/)",
    fill = "*Drug Overdose Deaths",
    caption = "*Number of drug overdose deaths"
  )


ggplot(data = merged_data, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = alcohol_impaired_driving_deaths_raw_value), color = "white") +
  scale_fill_viridis_c(option = "plasma", na.value = "grey50", labels = scales::percent_format(scale = 100)) +
  coord_fixed(1.3) +
  theme_minimal() +  # Apply the minimal theme
  theme(
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),  # Remove axis ticks
    text = element_text(family = "serif"),  # Set global text family to serif
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Center, bold the title, and increase font size
    plot.subtitle = element_text(hjust = 0.5, face = "plain", size = 8),  # Center the subtitle, normal weight, and reduce font size
    plot.caption = element_text(face = "italic", size = 6, hjust = 0)  # Italicize, reduce font size of the caption, and left-align
  ) +
  labs(
    title = "Alcohol Impaired Driving Deaths by State",
    subtitle = "Data source: County Health Rankings & Roadmaps (https://www.countyhealthrankings.org/)",
    fill = "*Alcohol Driving Deaths",
    caption = "*Percentage of motor vehicle crash deaths with alcohol involvement."
  )



```

## Correlation 

**We want to see what variables have correlation to our response variables, drug overdose deaths and alcohol impaired driving deaths**

```{r}
cor_matrix_d <- cor(health_data_new)
cor_matrix_a <- cor(health_data_new)

# DRUG
drug_correlations <- cor_matrix_d["drug_overdose_deaths", ]

# Convert to data frame for ggplot
drug_cor_df <- data.frame(
  Variable = names(drug_correlations),
  Correlation = as.numeric(drug_correlations)
)

# Plot
ggplot(drug_cor_df, aes(x = reorder(Variable, Correlation), y = Correlation, fill = Correlation > 0)) +
  geom_bar(stat = "identity") +
  coord_flip() +  
  labs(title = "Correlation: Drug Overdose Deaths", x = "Variable", y = "Correlation") +
  scale_fill_manual(values = c("red", "blue"), name = "Correlation Type",
                    labels = c("Negative", "Positive")) +
  theme_minimal() +
  theme(
    text = element_text(family = "serif", size = 12),
    plot.background = element_rect(fill = "white", colour = "white"),
    panel.background = element_rect(fill = "white", colour = "white")
  )
```

**Upon inspection, injury deaths, children in poverty, food insecurity, firearm fatalities, and income inequality are some of the variables with positive correlations with drug overdose deaths.** 

**Variables with negative correlation are median household income, some college, voter turnout, and census population** 


```{r}
# ALC !!
alcohol_correlations <- cor_matrix_a["alcohol_impaired_driving_deaths", ]

# Convert to dataframe for ggplot
alcohol_cor_df <- data.frame(
  Variable = names(alcohol_correlations),
  Correlation = as.numeric(alcohol_correlations)
)

# Plot
ggplot(alcohol_cor_df, aes(x = reorder(Variable, Correlation), y = Correlation, fill = Correlation > 0)) +
  geom_bar(stat = "identity") +
  coord_flip() +  # Flips the axes for better readability
  labs(title = "Correlation: Alcohol-Impaired Driving Deaths", x = "Variable", y = "Correlation") +
  scale_fill_manual(values = c("red", "blue"), name = "Correlation Type",
                    labels = c("Negative", "Positive")) +
  theme_minimal() +
  theme(
    text = element_text(family = "serif", size = 12),
    plot.background = element_rect(fill = "white", colour = "white"),
    panel.background = element_rect(fill = "white", colour = "white")
  )
```

**Variables with positive correlation with alcohol impaired driving deaths are american indian or alaska native, percent 65 or older, and highschool completion.** 

**Variables with negative correlation are food insecurity, uninsured, and children eligible for free or reduced lunch** 

```{r}


```

## Regression 

**Now to confirm what we see in the correlation matrices from before, we will conduct regression analysis to pick our predictors for drug overdose deaths and alcohol impaired deaths.** 


**Lasso Regression** 

```{r}
health_data_new <- health_data_new |> 
  filter(population > 3000) |> 
  mutate(across(everything(), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))


x <- as.matrix(health_data_new |>  select(-alcohol_impaired_driving_deaths))
y <- health_data_new$alcohol_impaired_driving_deaths





```

