```{r}
# Load necessary libraries
library(tidyverse)
library(glmnet)

health <- read_csv("../data/final_data.csv")

health <- health |> 
  select(-name, -...1) |> 
  mutate(across(everything(), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))

head(health)

response <- health$drug_overdose_deaths
predictors <- as.matrix(health |>  select(-drug_overdose_deaths))

set.seed(123)  # For reproducibility
cv_fit <- cv.glmnet(predictors, response, alpha = 1, nfolds = 10)

print(cv_fit)

plot(cv_fit)

best_lambda <- cv_fit$lambda.min
print(paste("Best lambda value: ", best_lambda))

final_model <- glmnet(predictors, response, alpha = 1, lambda = best_lambda)

print(coef(final_model))


```


```{r}
health_lm <- lm(drug_overdose_deaths ~ ., data = health)
library(broom)
health_lm |> 
  tidy() |> 
  mutate(term = fct_reorder(term, estimate)) |> 
  ggplot(aes(x = estimate, y = term, 
             fill = estimate > 0)) +
  geom_col(color = "white", show.legend = FALSE) +
  scale_fill_manual(values = c("darkred", "darkblue"))
```

