---
title: "question1"
author: "Dennis Campoverde-Lema"
date: "2024-06-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readxl)
library(janitor)
library(knitr)
library(broom)
```

```{r}
health_data <- read.csv("data/analytic_data2024.csv") |> 
  clean_names()

#glimpse(health_data)
```

```{r}
# Select relevant columns for the analysis
selected_data <- health_data |> 
  select(
    state_fips_code, county_fips_code, state_abbreviation, name,
    drug_overdose_deaths_raw_value, alcohol_impaired_driving_deaths_raw_value,
    unemployment_raw_value, income_inequality_raw_value, high_school_completion_raw_value, 
    adult_smoking_raw_value, excessive_drinking_raw_value, median_household_income_raw_value,
    some_college_raw_value, children_in_poverty_raw_value, children_in_single_parent_households_raw_value,
    social_associations_raw_value, x_below_18_years_of_age_raw_value, 
    x_65_and_older_raw_value, x_non_hispanic_black_raw_value, 
    x_american_indian_or_alaska_native_raw_value, x_asian_raw_value, 
    x_native_hawaiian_or_other_pacific_islander_raw_value, x_hispanic_raw_value, 
    x_non_hispanic_white_raw_value, x_not_proficient_in_english_raw_value, 
    x_female_raw_value, x_rural_raw_value
  )

# Convert relevant columns to numeric
selected_data <- selected_data |> 
  mutate(across(
    starts_with("drug_overdose_deaths_raw_value") | starts_with("alcohol_impaired_driving_deaths_raw_value") |
    starts_with("unemployment_raw_value") | starts_with("income_inequality_raw_value") | 
    starts_with("high_school_completion_raw_value") | starts_with("adult_smoking_raw_value") |
    starts_with("excessive_drinking_raw_value") | starts_with("median_household_income_raw_value") |
    starts_with("some_college_raw_value") | starts_with("children_in_poverty_raw_value") | 
    starts_with("children_in_single_parent_households_raw_value") | 
    starts_with("social_associations_raw_value") | starts_with("x_below_18_years_of_age_raw_value") | 
    starts_with("x_65_and_older_raw_value") | starts_with("x_non_hispanic_black_raw_value") | 
    starts_with("x_american_indian_or_alaska_native_raw_value") | starts_with("x_asian_raw_value") | 
    starts_with("x_native_hawaiian_or_other_pacific_islander_raw_value") | starts_with("x_hispanic_raw_value") | 
    starts_with("x_non_hispanic_white_raw_value") | starts_with("x_not_proficient_in_english_raw_value") | 
    starts_with("x_female_raw_value") | starts_with("x_rural_raw_value"),
    as.numeric
  ))



```

```{r}
#selected_data <- selected_data |> 
 # drop_na()
imputed_data <- selected_data |> 
  mutate(across(everything(), ~ifelse(is.na(.) | . == 0, mean(., na.rm = TRUE), .)))
```

```{r}
imputed_data |> 
  filter(county_fips_code == "000") |> 
  ggplot(aes(x = adult_smoking_raw_value, y = drug_overdose_deaths_raw_value, color = state_abbreviation)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Unemployment vs Drug Overdose Deaths",
       x = "Unemployment Rate",
       y = "Drug Overdose Deaths") +
  theme_bw() +
  theme(legend.position = "none") +
  geom_text(aes(label = state_abbreviation), vjust = -0.5, hjust = 0.5)
```

```{r}

imputed_data |> 
  filter(county_fips_code == "000") |> 
ggplot(aes(x = x_female_raw_value, y = alcohol_impaired_driving_deaths_raw_value, color = state_abbreviation)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Income Inequality vs Alcohol-Impaired Driving Deaths")+
  theme_bw() +
  theme(legend.position = "none") +
  geom_text(aes(label = state_abbreviation), vjust = -0.5, hjust = 0.5)
  

```

```{r}
model_drug <- lm(drug_overdose_deaths_raw_value ~ unemployment_raw_value + income_inequality_raw_value + 
                 high_school_completion_raw_value + adult_smoking_raw_value + excessive_drinking_raw_value + 
                 median_household_income_raw_value + some_college_raw_value + children_in_poverty_raw_value + 
                 children_in_single_parent_households_raw_value + social_associations_raw_value + 
                 x_below_18_years_of_age_raw_value + x_65_and_older_raw_value + 
                 x_non_hispanic_black_raw_value + x_american_indian_or_alaska_native_raw_value + 
                 x_asian_raw_value + x_native_hawaiian_or_other_pacific_islander_raw_value + 
                 x_hispanic_raw_value + x_non_hispanic_white_raw_value + 
                 x_not_proficient_in_english_raw_value + x_female_raw_value + 
                 x_rural_raw_value, data = imputed_data)

summary(model_drug)

```

```{r}
# Fit a linear model for Alcohol-Impaired Driving Deaths
model_alcohol <- lm(alcohol_impaired_driving_deaths_raw_value ~ unemployment_raw_value + income_inequality_raw_value + 
                    high_school_completion_raw_value + adult_smoking_raw_value + excessive_drinking_raw_value + 
                    median_household_income_raw_value + some_college_raw_value + children_in_poverty_raw_value + 
                    children_in_single_parent_households_raw_value + social_associations_raw_value + 
                    x_below_18_years_of_age_raw_value + x_65_and_older_raw_value + 
                    x_non_hispanic_black_raw_value + x_american_indian_or_alaska_native_raw_value + 
                    x_asian_raw_value + x_native_hawaiian_or_other_pacific_islander_raw_value + 
                    x_hispanic_raw_value + x_non_hispanic_white_raw_value + 
                    x_not_proficient_in_english_raw_value + x_female_raw_value + 
                    x_rural_raw_value, data = imputed_data)

summary(model_alcohol)


```

```{r}
# Interpretation and Discussion
# Extract coefficients and p-values for Drug Overdose Deaths model
drug_coefficients <- summary(model_drug)$coefficients

```

```{r}
# Extract coefficients and p-values for Alcohol-Impaired Driving Deaths model
alcohol_coefficients <- summary(model_alcohol)$coefficients

```

```{r}
# Display the coefficients and p-values
print(drug_coefficients)
print(alcohol_coefficients)

```

```{r}
# Reporting
# Summary table of model coefficients
kable(drug_coefficients, caption = "Drug Overdose Deaths Model Coefficients")
kable(alcohol_coefficients, caption = "Alcohol-Impaired Driving Deaths Model Coefficients")

```
